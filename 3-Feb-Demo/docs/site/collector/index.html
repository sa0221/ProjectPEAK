<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Collector - Project PEAK Documentation</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/fontawesome.min.css" rel="stylesheet">
        <link href="../css/brands.min.css" rel="stylesheet">
        <link href="../css/solid.min.css" rel="stylesheet">
        <link href="../css/v4-font-face.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link id="hljs-light" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" >
        <link id="hljs-dark" rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" disabled>
        <link href="../assets/_mkdocstrings.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="..">Project PEAK Documentation</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-bs-toggle="collapse" data-bs-target="#navbar-collapse" aria-controls="navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="nav-item">
                                <a href=".." class="nav-link">Home</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a href="#" class="nav-link dropdown-toggle active" aria-current="page" role="button" data-bs-toggle="dropdown"  aria-expanded="false">API Reference</a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="./" class="dropdown-item active" aria-current="page">Collector</a>
</li>
                                    
<li>
    <a href="../controller/" class="dropdown-item">Controller</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ms-md-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-bs-toggle="modal" data-bs-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href=".." class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../controller/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-bs-toggle="collapse" data-bs-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-body-tertiary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-bs-level="1"><a href="#collector-documentation" class="nav-link">Collector Documentation</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-bs-level="2"><a href="#collector" class="nav-link">collector</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.capture_adsb" class="nav-link">capture_adsb</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.capture_wifi" class="nav-link">capture_wifi</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.collect_and_send" class="nav-link">collect_and_send</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.get_collection_status" class="nav-link">get_collection_status</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.main" class="nav-link">main</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-bs-level="2"><a href="#collector.scan_bluetooth" class="nav-link">scan_bluetooth</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="collector-documentation">Collector Documentation</h1>


<div class="doc doc-object doc-module">



<a id="collector"></a>
    <div class="doc doc-contents first">

        <p>Collector Service Module for Project PEAK</p>
<p>This module implements an asynchronous signal collection service designed for distributed RF data gathering. 
It supports multiple hardware interfaces (Bluetooth, ADS-B via RTL-SDR, and Wi-Fi) to scan, capture, and process
electromagnetic signals from various sources, then forward the collected data to a centralized Controller API for 
further analysis and storage.</p>


<details class="key-features" open>
  <summary>Key Features</summary>
  <ul>
<li>Asynchronous scanning for high-performance, non-blocking operation.</li>
<li>Dynamic hardware detection: verifies presence of HackRF, RTL-SDR dongle, Bluetooth adapter, and Wi-Fi interfaces.</li>
<li>Concurrent execution of multiple scanning routines with robust error handling.</li>
<li>Automatic packaging of captured signals with metadata (timestamp, type, signal strength, etc.).</li>
<li>Reliable communication with the Controller API for device registration and signal data posting.</li>
</ul>
</details>

<details class="environment-variables" open>
  <summary>Environment Variables</summary>
  <ul>
<li>CONTROLLER_URL (str): The base URL for the Controller API (default: "http://controller:8000").</li>
<li>SCAN_INTERVAL (int): Interval in seconds between successive scanning cycles.</li>
<li>COLLECTION_TIMEOUT (int): Timeout in seconds for each scanning operation.</li>
</ul>
</details>

<details class="usage" open>
  <summary>Usage</summary>
  <p>This module should be executed directly. It enters an infinite asynchronous loop, constantly checking
if collection is active and then performing available hardware scans accordingly.</p>
</details>        <p>Author: [Your Name]
Date: 2025-04-14</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h2 id="collector.capture_adsb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">capture_adsb</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Capture ADS-B signals using the dump1090-mutability tool.</p>
<p>This method spawns a subprocess to execute dump1090-mutability in interactive mode,
capturing real-time output from an RTL-SDR dongle. The scan runs for up to COLLECTION_TIMEOUT seconds.
For each line that begins with an asterisk ("*"), indicating an ADS-B message,
a dictionary with the following keys is created:
  - Timestamp: Capture time in ISO format.
  - Type: "ADS-B" to denote the kind of signal.
  - Name/Address: Uses a hardcoded "Aircraft" identifier.
  - Signal Strength: "N/A" as a placeholder because actual RSSI measurement is not performed.
  - Frequency: "1090 MHz" representing ADS-B frequency.
  - Additional Info: Raw data (decoded message line).
  - Latitude/Longitude: Remain as None pending integration of geolocation.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict]: List of dictionaries with ADS-B signal data.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="error-handling" open>
  <summary>Error Handling</summary>
  <p>All subprocess exceptions are captured, and an empty list is returned in case of failure.</p>
</details>

<details class="note" open>
  <summary>Note</summary>
  <p>An operational RTL-SDR dongle is a prerequisite for this function to yield useful data.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">capture_adsb</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Capture ADS-B signals using the dump1090-mutability tool.</span>

<span class="sd">    This method spawns a subprocess to execute dump1090-mutability in interactive mode,</span>
<span class="sd">    capturing real-time output from an RTL-SDR dongle. The scan runs for up to COLLECTION_TIMEOUT seconds.</span>
<span class="sd">    For each line that begins with an asterisk (&quot;*&quot;), indicating an ADS-B message,</span>
<span class="sd">    a dictionary with the following keys is created:</span>
<span class="sd">      - Timestamp: Capture time in ISO format.</span>
<span class="sd">      - Type: &quot;ADS-B&quot; to denote the kind of signal.</span>
<span class="sd">      - Name/Address: Uses a hardcoded &quot;Aircraft&quot; identifier.</span>
<span class="sd">      - Signal Strength: &quot;N/A&quot; as a placeholder because actual RSSI measurement is not performed.</span>
<span class="sd">      - Frequency: &quot;1090 MHz&quot; representing ADS-B frequency.</span>
<span class="sd">      - Additional Info: Raw data (decoded message line).</span>
<span class="sd">      - Latitude/Longitude: Remain as None pending integration of geolocation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: List of dictionaries with ADS-B signal data.</span>

<span class="sd">    Error Handling:</span>
<span class="sd">        All subprocess exceptions are captured, and an empty list is returned in case of failure.</span>

<span class="sd">    Note:</span>
<span class="sd">        An operational RTL-SDR dongle is a prerequisite for this function to yield useful data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span>
            <span class="s2">&quot;dump1090-mutability&quot;</span><span class="p">,</span>
            <span class="s2">&quot;--interactive&quot;</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
        <span class="p">)</span>
        <span class="n">signals</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span> <span class="o">&lt;</span> <span class="n">COLLECTION_TIMEOUT</span><span class="p">:</span>
            <span class="n">line</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
                <span class="n">decoded</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">decoded</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                    <span class="n">signals</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                        <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;ADS-B&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;name_address&quot;</span><span class="p">:</span> <span class="s2">&quot;Aircraft&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;signal_strength&quot;</span><span class="p">:</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;1090 MHz&quot;</span><span class="p">,</span>
                        <span class="s2">&quot;additional_info&quot;</span><span class="p">:</span> <span class="n">decoded</span><span class="p">,</span>
                        <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
                        <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="kc">None</span>
                    <span class="p">})</span>
        <span class="n">proc</span><span class="o">.</span><span class="n">terminate</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">signals</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ADS-B error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="collector.capture_wifi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">capture_wifi</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Perform a Wi-Fi scan by capturing probe requests through tcpdump.</p>
<p>The function first determines an active wireless interface: it defaults to "wlan0"
but will dynamically select another interface that exposes wireless capabilities if needed.
It then spawns a subprocess to execute tcpdump with parameters to capture 10 packets (-c 10) in non-parsed format.
The scanned output is parsed line-by-line to create a list of dictionaries with:
  - Timestamp: ISO-formatted time of capture.
  - Type: "Wi-Fi" indicating this scan type.
  - Name/Address: Descriptive label "Probe Request".
  - Signal Strength: Set as "N/A" (placeholder).
  - Frequency: "2.4/5 GHz" indicating the common operating bands.
  - Additional Info: The raw tcpdump output line.
  - Latitude/Longitude: Remain None for future enhancement.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict]: List of detected Wi-Fi signals as dictionaries.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="exception-handling" open>
  <summary>Exception Handling</summary>
  <p>If the subprocess fails or no wireless interface is found, logs the error and returns an empty list.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">capture_wifi</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform a Wi-Fi scan by capturing probe requests through tcpdump.</span>

<span class="sd">    The function first determines an active wireless interface: it defaults to &quot;wlan0&quot;</span>
<span class="sd">    but will dynamically select another interface that exposes wireless capabilities if needed.</span>
<span class="sd">    It then spawns a subprocess to execute tcpdump with parameters to capture 10 packets (-c 10) in non-parsed format.</span>
<span class="sd">    The scanned output is parsed line-by-line to create a list of dictionaries with:</span>
<span class="sd">      - Timestamp: ISO-formatted time of capture.</span>
<span class="sd">      - Type: &quot;Wi-Fi&quot; indicating this scan type.</span>
<span class="sd">      - Name/Address: Descriptive label &quot;Probe Request&quot;.</span>
<span class="sd">      - Signal Strength: Set as &quot;N/A&quot; (placeholder).</span>
<span class="sd">      - Frequency: &quot;2.4/5 GHz&quot; indicating the common operating bands.</span>
<span class="sd">      - Additional Info: The raw tcpdump output line.</span>
<span class="sd">      - Latitude/Longitude: Remain None for future enhancement.</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: List of detected Wi-Fi signals as dictionaries.</span>

<span class="sd">    Exception Handling:</span>
<span class="sd">        If the subprocess fails or no wireless interface is found, logs the error and returns an empty list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interface</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;wlan0&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/sys/class/net/</span><span class="si">{</span><span class="n">interface</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">):</span>
            <span class="n">interfaces</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;/sys/class/net&quot;</span><span class="p">)</span>
            <span class="n">interface</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">interfaces</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/sys/class/net/</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">/wireless&quot;</span><span class="p">)),</span> <span class="s2">&quot;eth0&quot;</span><span class="p">)</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span>
            <span class="s2">&quot;tcpdump&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-i&quot;</span><span class="p">,</span> <span class="n">interface</span><span class="p">,</span>
            <span class="s2">&quot;-c&quot;</span><span class="p">,</span> <span class="s2">&quot;10&quot;</span><span class="p">,</span>
            <span class="s2">&quot;-nn&quot;</span><span class="p">,</span>
            <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span>
            <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span>
        <span class="p">)</span>
        <span class="n">output</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">[{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Wi-Fi&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name_address&quot;</span><span class="p">:</span> <span class="s2">&quot;Probe Request&quot;</span><span class="p">,</span>
            <span class="s2">&quot;signal_strength&quot;</span><span class="p">:</span> <span class="s2">&quot;N/A&quot;</span><span class="p">,</span>
            <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4/5 GHz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;additional_info&quot;</span><span class="p">:</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">(),</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">output</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wi-Fi scan error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="collector.collect_and_send" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">collect_and_send</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Main orchestration routine for dynamic hardware detection, signal collection, and communication with the Controller API.</p>


<details class="operational-steps" open>
  <summary>Operational Steps</summary>
  <ol>
<li><strong>Hardware Detection</strong>:</li>
<li>Checks for the presence of HackRF (for SDR), RTL-SDR dongles (for ADS-B),
     Bluetooth adapters (via 'hciconfig') and wireless interfaces.</li>
<li>The results are compiled into a human-readable device list.</li>
<li><strong>Device Registration</strong>:</li>
<li>Posts the detected devices list to the Controller at the '/api/devices' endpoint.</li>
<li>If posting fails, it retries until successful.</li>
<li><strong>Signal Collection Loop</strong>:</li>
<li>Periodically checks the Controller's collection status (via '/api/collection-status').</li>
<li>If active, concurrently dispatches available scan routines (Bluetooth, ADS-B, Wi-Fi).</li>
<li>Aggregates all scan results, then sends the collection to the Controller's '/api/collect' endpoint.</li>
<li>Waits for SCAN_INTERVAL seconds before starting the next cycle.</li>
</ol>
</details>

<details class="exception-handling" open>
  <summary>Exception Handling</summary>
  <ul>
<li>Individual scan methods handle errors and return empty results on failure.</li>
<li>The overall loop logs failures without breaking, ensuring continuous operation.</li>
</ul>
</details>

    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>None</code></td>            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The function perpetually runs in an asynchronous event loop.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="design-consideration" open>
  <summary>Design Consideration</summary>
  <ul>
<li>Uses asyncio.gather to perform scanning concurrently. This design optimizes resource usage while
  ensuring that hardware detection is adaptive and robust.</li>
</ul>
</details>

            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">collect_and_send</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Main orchestration routine for dynamic hardware detection, signal collection, and communication with the Controller API.</span>

<span class="sd">    Operational Steps:</span>
<span class="sd">      1. **Hardware Detection**:</span>
<span class="sd">         - Checks for the presence of HackRF (for SDR), RTL-SDR dongles (for ADS-B),</span>
<span class="sd">           Bluetooth adapters (via &#39;hciconfig&#39;) and wireless interfaces.</span>
<span class="sd">         - The results are compiled into a human-readable device list.</span>
<span class="sd">      2. **Device Registration**:</span>
<span class="sd">         - Posts the detected devices list to the Controller at the &#39;/api/devices&#39; endpoint.</span>
<span class="sd">         - If posting fails, it retries until successful.</span>
<span class="sd">      3. **Signal Collection Loop**:</span>
<span class="sd">         - Periodically checks the Controller&#39;s collection status (via &#39;/api/collection-status&#39;).</span>
<span class="sd">         - If active, concurrently dispatches available scan routines (Bluetooth, ADS-B, Wi-Fi).</span>
<span class="sd">         - Aggregates all scan results, then sends the collection to the Controller&#39;s &#39;/api/collect&#39; endpoint.</span>
<span class="sd">         - Waits for SCAN_INTERVAL seconds before starting the next cycle.</span>

<span class="sd">    Exception Handling:</span>
<span class="sd">      - Individual scan methods handle errors and return empty results on failure.</span>
<span class="sd">      - The overall loop logs failures without breaking, ensuring continuous operation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None: The function perpetually runs in an asynchronous event loop.</span>

<span class="sd">    Design Consideration:</span>
<span class="sd">      - Uses asyncio.gather to perform scanning concurrently. This design optimizes resource usage while</span>
<span class="sd">        ensuring that hardware detection is adaptive and robust.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">devices_posted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">hackrf_present</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">rtlsdr_present</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bt_present</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">wifi_ifaces</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Check for HackRF One device (SDR)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span><span class="s2">&quot;hackrf_info&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">hackrf_present</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Check for RTL-SDR dongle (required for ADS-B)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span><span class="s2">&quot;rtl_test&quot;</span><span class="p">,</span> <span class="s2">&quot;-t&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
        <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">proc</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">rtlsdr_present</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="c1"># Check for Bluetooth adapter via hciconfig output.</span>
    <span class="n">proc</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_subprocess_exec</span><span class="p">(</span><span class="s2">&quot;hciconfig&quot;</span><span class="p">,</span> <span class="n">stdout</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">stderr</span><span class="o">=</span><span class="n">asyncio</span><span class="o">.</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
    <span class="n">stdout</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="k">await</span> <span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
    <span class="k">if</span> <span class="sa">b</span><span class="s2">&quot;hci0&quot;</span> <span class="ow">in</span> <span class="n">stdout</span><span class="p">:</span>
        <span class="n">bt_present</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Detect available Wi-Fi interfaces based on the presence of &#39;wireless&#39; directories.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">wifi_ifaces</span> <span class="o">=</span> <span class="p">[</span><span class="n">iface</span> <span class="k">for</span> <span class="n">iface</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s2">&quot;/sys/class/net&quot;</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;/sys/class/net/</span><span class="si">{</span><span class="n">iface</span><span class="si">}</span><span class="s2">/wireless&quot;</span><span class="p">)]</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="n">wifi_ifaces</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Create a descriptive device list.</span>
    <span class="n">device_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">hackrf_present</span><span class="p">:</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;HackRF One&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">rtlsdr_present</span><span class="p">:</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;RTL-SDR dongle&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">wifi_ifaces</span><span class="p">:</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wi-Fi (</span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">wifi_ifaces</span><span class="p">)</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">bt_present</span><span class="p">:</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Bluetooth adapter&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">device_list</span><span class="p">:</span>
        <span class="n">device_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;No RF devices detected&quot;</span><span class="p">)</span>

    <span class="c1"># Register detected devices with the Controller API.</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CONTROLLER_URL</span><span class="si">}</span><span class="s2">/api/devices&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="n">device_list</span><span class="p">})</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Collector] Detected devices: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">devices_posted</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Collector] Device info post failed: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">devices_posted</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># Main asynchronous loop for repetitive scanning and signal reporting.</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1"># Retry device registration if necessary.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">devices_posted</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
                    <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CONTROLLER_URL</span><span class="si">}</span><span class="s2">/api/devices&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;devices&quot;</span><span class="p">:</span> <span class="n">device_list</span><span class="p">})</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Collector] Detected devices: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">device_list</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">devices_posted</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Collector] Retry device post: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Proceed with scanning only if collection is enabled by the Controller.</span>
        <span class="k">if</span> <span class="k">await</span> <span class="n">get_collection_status</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Collector] Starting collection cycle...&quot;</span><span class="p">)</span>
            <span class="n">tasks</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">if</span> <span class="n">bt_present</span><span class="p">:</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">scan_bluetooth</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">rtlsdr_present</span><span class="p">:</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">capture_adsb</span><span class="p">()))</span>
            <span class="k">if</span> <span class="n">wifi_ifaces</span><span class="p">:</span>
                <span class="n">tasks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">capture_wifi</span><span class="p">()))</span>
            <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">)</span> <span class="k">if</span> <span class="n">tasks</span> <span class="k">else</span> <span class="p">[]</span>
            <span class="n">all_signals</span> <span class="o">=</span> <span class="p">[</span><span class="n">signal</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="n">results</span> <span class="k">for</span> <span class="n">signal</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">]</span>
            <span class="c1"># Send aggregated signals to Controller API if any have been collected.</span>
            <span class="k">if</span> <span class="n">all_signals</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
                        <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CONTROLLER_URL</span><span class="si">}</span><span class="s2">/api/collect&quot;</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">all_signals</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[Collector] Sent </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_signals</span><span class="p">)</span><span class="si">}</span><span class="s2"> signals&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to send data: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[Collector] No signals collected&quot;</span><span class="p">)</span>
        <span class="c1"># Wait before beginning the next cycle.</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">SCAN_INTERVAL</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="collector.get_collection_status" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_collection_status</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Retrieve and report whether the centralized Controller has activated data collection.</p>
<p>The function makes an asynchronous GET request to the '/api/collection-status' endpoint on the Controller.
In the case of errors (e.g., network issues or unexpected responses), it logs the error and returns False,
thereby ensuring the collector does not scan unless the controller explicitly indicates active collection.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bool</code></td>            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>True if the Controller API signals that signal collection is active, else False.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="design-note" open>
  <summary>Design Note</summary>
  <p>This check is performed periodically before each scan cycle to conserve resources.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">get_collection_status</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve and report whether the centralized Controller has activated data collection.</span>

<span class="sd">    The function makes an asynchronous GET request to the &#39;/api/collection-status&#39; endpoint on the Controller.</span>
<span class="sd">    In the case of errors (e.g., network issues or unexpected responses), it logs the error and returns False,</span>
<span class="sd">    thereby ensuring the collector does not scan unless the controller explicitly indicates active collection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        bool: True if the Controller API signals that signal collection is active, else False.</span>

<span class="sd">    Raises:</span>
<span class="sd">        Exception details are printed to standard output for debugging purposes.</span>

<span class="sd">    Design Note:</span>
<span class="sd">        This check is performed periodically before each scan cycle to conserve resources.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">async</span> <span class="k">with</span> <span class="n">httpx</span><span class="o">.</span><span class="n">AsyncClient</span><span class="p">()</span> <span class="k">as</span> <span class="n">client</span><span class="p">:</span>
            <span class="n">response</span> <span class="o">=</span> <span class="k">await</span> <span class="n">client</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">CONTROLLER_URL</span><span class="si">}</span><span class="s2">/api/collection-status&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;active&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error getting collection status: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="collector.main" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">main</span><span class="p">()</span></code>

</h2>


    <div class="doc doc-contents ">

        <p>Entry point for the Collector service module.</p>
<p>Invokes the asynchronous collect_and_send() routine using asyncio.run(), initiating the perpetual scanning loop.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Entry point for the Collector service module.</span>

<span class="sd">    Invokes the asynchronous collect_and_send() routine using asyncio.run(), initiating the perpetual scanning loop.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">asyncio</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">collect_and_send</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="collector.scan_bluetooth" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scan_bluetooth</span><span class="p">()</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h2>


    <div class="doc doc-contents ">

        <p>Conduct a Bluetooth Low Energy (BLE) scan for nearby devices using the Bleak library.</p>
<p>This function leverages BleakScanner.discover to detect BLE devices for up to COLLECTION_TIMEOUT seconds.
For every device found, it returns a dictionary with:
  - Timestamp: When the device was detected (ISO format).
  - Type: "Bluetooth" (identifies the scan type).
  - Name/Address: Combines the device name (if available) with its hardware address.
  - Signal Strength: Hardcoded placeholder (-70 dBm) pending future enhancement.
  - Frequency: "2.4 GHz" to denote typical BLE operation frequency.
  - Latitude/Longitude: Set as None (reserved for future geo-tagging).</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="list">list</span>[<span title="dict">dict</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list[dict]: A list of dictionaries, each representing an individual BLE device detection.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="exception-handling" open>
  <summary>Exception Handling</summary>
  <p>Any scanning error is caught, logged, and the function returns an empty list.</p>
</details>

<details class="future-enhancement" open>
  <summary>Future Enhancement</summary>
  <p>Signal strength measurement may be refined to capture actual RSSI values dynamically.</p>
</details>

            <details class="quote">
              <summary>Source code in <code>3-Feb-Demo/collector.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">scan_bluetooth</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Conduct a Bluetooth Low Energy (BLE) scan for nearby devices using the Bleak library.</span>

<span class="sd">    This function leverages BleakScanner.discover to detect BLE devices for up to COLLECTION_TIMEOUT seconds.</span>
<span class="sd">    For every device found, it returns a dictionary with:</span>
<span class="sd">      - Timestamp: When the device was detected (ISO format).</span>
<span class="sd">      - Type: &quot;Bluetooth&quot; (identifies the scan type).</span>
<span class="sd">      - Name/Address: Combines the device name (if available) with its hardware address.</span>
<span class="sd">      - Signal Strength: Hardcoded placeholder (-70 dBm) pending future enhancement.</span>
<span class="sd">      - Frequency: &quot;2.4 GHz&quot; to denote typical BLE operation frequency.</span>
<span class="sd">      - Latitude/Longitude: Set as None (reserved for future geo-tagging).</span>

<span class="sd">    Returns:</span>
<span class="sd">        list[dict]: A list of dictionaries, each representing an individual BLE device detection.</span>

<span class="sd">    Exception Handling:</span>
<span class="sd">        Any scanning error is caught, logged, and the function returns an empty list.</span>

<span class="sd">    Future Enhancement:</span>
<span class="sd">        Signal strength measurement may be refined to capture actual RSSI values dynamically.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">devices</span> <span class="o">=</span> <span class="k">await</span> <span class="n">BleakScanner</span><span class="o">.</span><span class="n">discover</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="n">COLLECTION_TIMEOUT</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[{</span>
            <span class="s2">&quot;timestamp&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Bluetooth&quot;</span><span class="p">,</span>
            <span class="s2">&quot;name_address&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="s1">&#39;Unknown&#39;</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">d</span><span class="o">.</span><span class="n">address</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span>
            <span class="s2">&quot;signal_strength&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">70</span><span class="p">,</span>
            <span class="s2">&quot;frequency&quot;</span><span class="p">:</span> <span class="s2">&quot;2.4 GHz&quot;</span><span class="p">,</span>
            <span class="s2">&quot;latitude&quot;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s2">&quot;longitude&quot;</span><span class="p">:</span> <span class="kc">None</span>
        <span class="p">}</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">devices</span><span class="p">]</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Bluetooth scan error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/bootstrap.bundle.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
